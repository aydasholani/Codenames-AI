<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YOLO and OCR Detection</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous"> -->
</head>
<body>
    <div class="container">
        <h2>Upload an Image for Detection</h2>
        
        <form id="uploadForm" enctype="multipart/form-data" method="post" action="/upload">
            <!-- Dold filuppladdning med knapp för visuell representation -->
            <label for="fileInput" class="label-button">Choose an Image</label>
            <input type="file" name="file" id="fileInput" accept="image/*" onchange="showSelectedFile()">
            
            <button type="button" onclick="uploadImage()">Upload and Detect</button>
        </form>

        <!-- Visar valt filnamn -->
        <p id="fileName" style="margin-top: 10px; color: #555;"></p>

        <!-- Förhandsvisning av bilden -->
        
        <!-- Resultatområde -->
        <div id="results" class="result"></div>
        
                <div id="previewContainer" style="margin-top: 20px;">
                  <img id="previewImage" src="" alt="Image preview" style="max-width: 100%; display: none; border-radius: 8px;"/>
                </div>
      </div>
      
    <script>
        function showSelectedFile() {
            const fileInput = document.getElementById('fileInput');
            const fileNameDisplay = document.getElementById('fileName');
            const previewImage = document.getElementById('previewImage');
            const file = fileInput.files[0];

            if (file) {
                fileNameDisplay.textContent = `Selected: ${file.name}`;

                // Skapa en URL för förhandsvisningen
                const reader = new FileReader();
                reader.onload = function (e) {
                    previewImage.src = e.target.result;
                    previewImage.style.display = 'block';  // Visa förhandsvisningsbilden
                };
                reader.readAsDataURL(file);
            } else {
                fileNameDisplay.textContent = '';
                previewImage.style.display = 'none';  // Dölj om ingen bild är vald
            }
        }

        async function uploadImage() {
            const formData = new FormData();
            const fileInput = document.getElementById('fileInput');

            if (!fileInput.files[0]) {
                alert("Please select an image file first.");
                return;
            }

            formData.append('file', fileInput.files[0]);

            const response = await fetch('/upload', {
                method: 'POST',
                body: formData
            });
            
            const result = await response.json();
            console.log(result);
            const resultDisplay = document.getElementById('results');
            resultDisplay.innerText = result.detected_words ? `Detected Words: ${result.detected_words.join(", ")}` : "No words detected";
        }
    </script>
</body>
</html>
