<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waiting Room</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Waiting Room</h1>
        <h2>Room ID: {{ room_id }}</h2>

        <h3>Connected Users:</h3>
        <ul id="user-list"></ul>
    </div>

    <!-- Socket.IO och script för att hantera anslutning -->
    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
    
    <script type="text/javascript">
        document.addEventListener("DOMContentLoaded", function () {
          const socket = io();
      
          // Hämta room_id och username från URL-parametrarna
          const roomId = new URLSearchParams(window.location.search).get("room_id");
          const username = new URLSearchParams(window.location.search).get("username");
      
          // Gå med i rummet direkt efter att sidan laddats
          socket.emit("join_room_event", { room_id: roomId, username: username });
      
          // Hantera lyckad anslutning till rummet
          socket.on("join_success", (data) => {
            console.log(`${data.username} has joined room ${data.room_id}`);
          });
      
          // Uppdatera när andra användare ansluter till rummet
          socket.on("user_joined", function(data) {
            const userList = document.getElementById("user-list");
            const existingUser = Array.from(userList.children).find(
              (li) => li.textContent === `${data.username} joined the room`
            );
            
            if (!existingUser) {
              const newUser = document.createElement("li");
              newUser.textContent = `${data.username} joined the room`;
              userList.appendChild(newUser);
            }
          });
          socket.on("user_left", function(data) {
            const userList = document.getElementById("user-list");
            const userItem = Array.from(userList.children).find(
                (li) => li.textContent === `${data.username} joined the room`
            );
            
            if (userItem) {
                userItem.textContent = `${data.username} left the room`;
                userItem.style.color = "red"; // Ändra färgen eller visa på annat sätt
            }
        });
        });
      </script>
</body>
</html>
