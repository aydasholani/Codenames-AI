<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Waiting Room</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container mt-5">
      <h1>Waiting Room</h1>
      {% if is_owner %}
        <button id="delete-room" class="btn btn-danger">Delete Room</button>
    {% endif %}
      <h2>Room ID: {{ room_id }}</h2>

      <h3>Connected Users:</h3>
      <ul id="user-list"></ul>
    </div>

    <!-- Socket.IO och script för att hantera anslutning -->
    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>

    <script type="text/javascript">

      document.addEventListener("DOMContentLoaded", function () {
        const socket = io();

        // Hämta room_id och username från URL-parametrarna
        const roomId = new URLSearchParams(window.location.search).get(
          "room_id"
        );
        const username = new URLSearchParams(window.location.search).get(
          "username"
        );

        const owner_id = sessionStorage.getItem("owner_id");
        console.log(owner_id)
        // Gå med i rummet direkt efter att sidan laddats
        socket.emit("join_room_event", { room_id: roomId, username: username });

        // Hantera lyckad anslutning till rummet
        socket.on("join_success", (data) => {
          console.log(`${data.username} has joined room ${data.room_id}`);
        });
        // Uppdaterar användarlistan när en ny användare ansluter
        socket.on("update_user_list", function (data) {
          const userList = document.getElementById("user-list");
          userList.innerHTML = ""; // Rensar listan för att förhindra duplicering

          data.users.forEach((user) => {
            const newUser = document.createElement("li");
            newUser.textContent = `${user} joined the room`;
            userList.appendChild(newUser);
          });
        });

        // Hantera användare som lämnar rummet
        socket.on("user_left", function (data) {
          const userList = document.getElementById("user-list");
          const userItem = Array.from(userList.children).find((li) =>
            li.textContent.includes(data.username)
          );
          if (userItem) {
            userItem.textContent = `${data.username} left the room`;
            userItem.style.color = "red"; // Visar att användaren har lämnat
          }
        });

      });
    </script>
  </body>
</html>
